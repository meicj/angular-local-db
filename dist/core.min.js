/*!
 * corgular-modules-core
 * https://github.com/meicj/corgular-modules-core
 * Version: 0.0.1 - 2016-03-06T16:40:32.696Z
 * License: MIT
 */
!function(){"use strict";angular.module("core",[])}(),function(){"use strict";function e(){return{get:function(){var e=angular.element(document.body).injector();return e.get.apply(e.get,arguments)}}}function n(e,n){n._debugHelper=e}n.$inject=["debugHelper","$window"],angular.module("core").factory("debugHelper",e).run(n)}(),function(){"use strict";function e(e,n,r,t){var o;return{ready:function(){var i=e.defer(),u=1e4;return o?i.resolve():(n.document.addEventListener("deviceready",function(){t.log("device is ready"),o=!0,i.resolve()},!1),r(function(){o||(t.error("ready: device was not ready after "+u/1e3+"s."),i.reject("device ready timeout"))},u)),i.promise}}}e.$inject=["$q","$window","$timeout","$log"],angular.module("core").factory("device",e)}(),function(){"use strict";function e(e){var n="logger";return r||(r=e.has(n)&&e.get(n)||{error:function(){console.warn("exceptionHandler: Implement `logger.error()` to log the error. ",arguments)}})}function n(n){var r=window.onerror;window.onerror=function(t,o,i){return e(n).error("window.error",t,o,i),r?r(t,o,i):!1}}n.$inject=["$injector"];var r;angular.module("core").run(n)}(),function(){"use strict";function e(){var e,t=this;t.getDefaultDBName=function(){return"app"},t.getDBProvider=function(){return e||(e=window.sqlitePlugin)},t.$get=n,r=t}function n(e,n,t){var o,i,u,a={};return u=r,o={getDB:function(r){var o;return e.when(t.ready()).then(function(){return r||u.getDefaultDBName()}).then(function(r){return o=e.defer(),r?a[r]?o.resolve(a[r]):u.getDBProvider().openDatabase({name:r},function(e){a[r]=e,o.resolve(e)},function(e){n.error("_getDB:",e),o.reject(e)}):(n.error("_getDB：parameter of `dbName` was empty"),o.reject("db name is empty")),o.promise})},transaction_executeSql:function(e,r,t,i,u){e.executeSql(r,t,function(e,n){i&&i(n,o.buildTransaction(e))},function(e,t){return n.error("transaction_executeSql:",t,r),u&&u(t&&t.message,o.buildTransaction(e)),!0})},buildTransaction:function(e){var n={};return n.insert=function(n,r,t,o,u){i.insert(n,r,t,null,e,o,u)},n.update=function(n,r,t,o,u){i.update(n,r,t,e,o,u)},n["delete"]=function(n,r,t,o){i["delete"](n,r,e,t,o)},n.exists=function(n,r,t,o){i.exists(n,r,null,e,t,o)},n},buildConditionSql:function(e){var n,r;if(!angular.isObject(e))throw new Error("invalid argument");n=[],r=[];for(var t in e)if(e.hasOwnProperty(t)){if(!e[t]&&0!==e[t]&&""!==e[t])throw new Error("condition["+t+"] was empty");r.push(e[t]),n.push('"'+t+'" = ?')}if(0===n.length)throw new Error("invalid argument of `columnsObj`");return n=n.join(" and "),{sql:n,values:r}},checkObjPropHasValue:function(e,n){return e[n]||0===e[n]}},i={executeSql:function(r,t,i){var u,a=arguments;return e.when(o.getDB(i)).then(function(o){return u=e.defer(),o.executeSql(r,t,function(e){u.resolve(e)},function(e){n.error("executeSql:",e,JSON.stringify(a)),u.reject(e&&e.message)}),u.promise})},query:function(e,n,r){return i.executeSql(e,n,r).then(function(e){return i.getRowsToArray(e.rows)})},queryOne:function(e,n,r){return e+=" limit 1",i.executeSql(e,n,r).then(function(e){return e.rows&&e.rows.length?e.rows.item(0):void 0})},getRowsToArray:function(e){var n=[];e=e||[];for(var r=0,t=e.length;t>r;r++)n[r]=e.item(r);return n},transaction:function(r,t){var i=function(e){var n=o.buildTransaction(e);r(n)};return o.getDB(t).then(function(r){var t=e.defer();return r.transaction(i,function(e){n.error("transaction:",e),t.reject()},function(e){t.resolve(e)}),t.promise})},exists:function(e,n,r,t,u,a){var c,l,s,f,d=function(e){return e&&e.rows&&e.rows.length?!!e.rows.item(0).exists:!1};return c=o.buildConditionSql(n),l=c.sql,s=c.values,f='select 1 "exists" from '+e+" where "+l+" limit 1",t?o.transaction_executeSql(t,f,s,function(e,n){var r=d(e);u&&u(r,n)},a):i.executeSql(f,s,r).then(function(e){return d(e)})},insert:function(e,n,r,t,u,a,c){var l,s,f;if(!(e&&e.length&&angular.isArray(n)&&n.length&&angular.isArray(r)&&r.length&&n.length===r.length))throw new Error("invalid arguments");var d=function(e){var n=[];return e.forEach(function(){n.push("?")}),n.join(",")};return s=n.join('","'),f=d(r),l="insert into "+e+' ( "'+s+'" ) values ( '+f+" )",u?o.transaction_executeSql(u,l,r,a,c):i.executeSql(l,r,t)},update:function(e,n,r,t,u,a){var c,l,s,f,d,g,v,m;if(!(e&&e.length&&angular.isObject(n)&&angular.isObject(r)))throw new Error("invalid arguments");l=[],f=[];for(v in n)if(n.hasOwnProperty(v)){if(void 0===n[v])throw new Error("column["+v+"] was empty");l.push('"'+v+'" = ?'),f.push(n[v])}if(0===l.length)throw new Error("columnsObj invalid arguments");return l=l.join(" , "),m=o.buildConditionSql(r),s=m.sql,d=m.values,c="update "+e+" set "+l+"  where "+s,g=f.concat(d),t?o.transaction_executeSql(t,c,g,u,a):i.executeSql(c,g)},"delete":function(e,n,r,t,u){var a,c,l,s;if(!e||!e.length||!angular.isObject(n))throw new Error("invalid arguments");return s=o.buildConditionSql(n),c=s.sql,l=s.values,a="delete from "+e+" where "+c,r?o.transaction_executeSql(r,a,l,t,u):i.executeSql(a,l)},getColumnsValues:function(e,n,r){var t=[];return r=r||[],n.forEach(function(n){if(o.checkObjPropHasValue(e,n))t.push(e[n]);else{if(-1===r.indexOf(n))throw new Error(n+"was empty");t.push("")}}),t},existsTable:function(e,n){return i.exists("sqlite_master",{type:"table",name:e},n)},existsColumn:function(e,n,r){return i.query("PRAGMA table_info('"+e+"')",[],r).then(function(e){return e?e.some(function(e){return e.name===n}):!1})},clearOpenedInstance:function(){a={}},deleteDB:function(r){var i;return e.when(t.ready()).then(function(){return r||o.getDefaultDBName()}).then(function(r){return i=e.defer(),r?(a[r]&&(a[r]=null,delete a[r]),o.getDBProvider().deleteDatabase(r,function(){i.resolve()},function(e){n.error("deleteDB:",e),i.reject(e&&e.message||e)})):(n.error("deleteDB：dbName is empty"),i.reject("db name is empty")),i.promise})}}}n.$inject=["$q","$log","device"];var r;angular.module("core").provider("localDB",e)}();