/*!
 * corgular-modules-core
 * https://github.com/meicj/corgular-modules-core
 * Version: 0.0.1 - 2016-03-11T12:08:36.089Z
 * License: MIT
 */
!function(){"use strict";angular.module("core",[])}(),function(){"use strict";function e(){return{get:function(){var e=angular.element(document.body).injector();return e.get.apply(e.get,arguments)}}}function r(e,r){r._debugHelper=e}r.$inject=["debugHelper","$window"],angular.module("core").factory("debugHelper",e).run(r)}(),function(){"use strict";function e(e,r,n,t){var o;return{ready:function(){var i=e.defer(),u=1e4;return o?i.resolve():(r.document.addEventListener("deviceready",function(){t.log("device is ready"),o=!0,i.resolve()},!1),n(function(){o||(t.error("ready: device was not ready after "+u/1e3+"s."),i.reject("device ready timeout"))},u)),i.promise}}}e.$inject=["$q","$window","$timeout","$log"],angular.module("core").factory("device",e)}(),function(){"use strict";function e(){var e=this;e.isHttpResultError=function(e){return e&&e.error_code},e.$get={},u=e}function r(e){var r="logger";return i||(i=e.has(r)&&e.get(r)||{error:function(e,r){console.warn("exceptionHandler: Implement `logger.error()` to log the error. ",arguments)}})}function n(e){var n=window.onerror;window.onerror=function(t,o,i){return r(e).error("window.error",{message:t,file:o,line:i}),n?n.call(this,arguments):!1}}function t(e){function n(e,n){var t=e.error;return e.error=function(){var o,i=[],u=" ",a=function(e){return"string"==typeof e?e:JSON.stringify(e)};t.apply(e,arguments),angular.forEach(arguments,function(e){o?o.message+=u+a(e):angular.isObject(e)&&"message"in e?(o=e,i.push(o.message),o.message=i.join(u)):i.push(a(e))}),o||(o={message:i.join(u)}),r(n).error("angular.error",o)},e}n.$inject=["$delegate","$injector"],e.decorator("$log",n)}function o(e){function n(e,n,t){return{request:function(e){return e._time_start=(new Date).getTime(),e},response:function(e){var o;return u.isHttpResultError(e.data)&&(o={file:e.config.url,message:n.JSON.stringify(e.data),remark:n.JSON.stringify({config:e.config})},r(t).error("http.result.error",o)),e},responseError:function(o){var i,u,a,c,s;return c=o.status||"",o.statusText&&(c+="("+o.statusText+") "),c=c||"unknown",o.config._time_start&&(u=(new Date).getTime(),a=u-o.config._time_start,o.config.timeout&&-1!=o.config.timeout&&a>=o.config.timeout&&(c+="timeout")),s=a?"duration: "+a+"ms ":"",s+=n.JSON.stringify(o),i={file:o.config.url,message:c,remark:s},r(t).error("http.status.error",i),e.reject(o)}}}n.$inject=["$q","$window","$injector"],e.interceptors.push(n)}n.$inject=["$injector"],t.$inject=["$provide"],o.$inject=["$httpProvider"];var i,u;angular.module("core").provider("exceptionHandler",e).run(n).config(t).config(o)}(),function(){"use strict";function e(){var e,t=this;t.getDefaultDBName=function(){return"app"},t.getDBProvider=function(){return e||(e=window.sqlitePlugin)},t.$get=r,n=t}function r(e,r,t){var o,i,u,a={};return u=n,o={getDB:function(n){var o;return e.when(t.ready()).then(function(){return n||u.getDefaultDBName()}).then(function(n){return o=e.defer(),n?a[n]?o.resolve(a[n]):u.getDBProvider().openDatabase({name:n},function(e){a[n]=e,o.resolve(e)},function(e){r.error("_getDB:",e),o.reject(e)}):(r.error("_getDB：parameter of `dbName` was empty"),o.reject("db name is empty")),o.promise})},transaction_executeSql:function(e,n,t,i,u){e.executeSql(n,t,function(e,r){i&&i(r,o.buildTransaction(e))},function(e,t){return r.error("transaction_executeSql:",t,n),u&&u(t&&t.message,o.buildTransaction(e)),!0})},buildTransaction:function(e){var r={};return r.insert=function(r,n,t,o,u){i.insert(r,n,t,null,e,o,u)},r.update=function(r,n,t,o,u){i.update(r,n,t,e,o,u)},r["delete"]=function(r,n,t,o){i["delete"](r,n,e,t,o)},r.exists=function(r,n,t,o){i.exists(r,n,null,e,t,o)},r},buildConditionSql:function(e){var r,n;if(!angular.isObject(e))throw new Error("invalid argument");r=[],n=[];for(var t in e)if(e.hasOwnProperty(t)){if(!e[t]&&0!==e[t]&&""!==e[t])throw new Error("condition["+t+"] was empty");n.push(e[t]),r.push('"'+t+'" = ?')}if(0===r.length)throw new Error("invalid argument of `columnsObj`");return r=r.join(" and "),{sql:r,values:n}},checkObjPropHasValue:function(e,r){return e[r]||0===e[r]}},i={executeSql:function(n,t,i){var u,a=arguments;return e.when(o.getDB(i)).then(function(o){return u=e.defer(),o.executeSql(n,t,function(e){u.resolve(e)},function(e){r.error("executeSql:",e,JSON.stringify(a)),u.reject(e&&e.message)}),u.promise})},query:function(e,r,n){return i.executeSql(e,r,n).then(function(e){return i.getRowsToArray(e.rows)})},queryOne:function(e,r,n){return e+=" limit 1",i.executeSql(e,r,n).then(function(e){return e.rows&&e.rows.length?e.rows.item(0):void 0})},getRowsToArray:function(e){var r=[];e=e||[];for(var n=0,t=e.length;t>n;n++)r[n]=e.item(n);return r},transaction:function(n,t){var i=function(e){var r=o.buildTransaction(e);n(r)};return o.getDB(t).then(function(n){var t=e.defer();return n.transaction(i,function(e){r.error("transaction:",e),t.reject()},function(e){t.resolve(e)}),t.promise})},exists:function(e,r,n,t,u,a){var c,s,l,f,g=function(e){return e&&e.rows&&e.rows.length?!!e.rows.item(0).exists:!1};return c=o.buildConditionSql(r),s=c.sql,l=c.values,f='select 1 "exists" from '+e+" where "+s+" limit 1",t?o.transaction_executeSql(t,f,l,function(e,r){var n=g(e);u&&u(n,r)},a):i.executeSql(f,l,n).then(function(e){return g(e)})},insert:function(e,r,n,t,u,a,c){var s,l,f;if(!(e&&e.length&&angular.isArray(r)&&r.length&&angular.isArray(n)&&n.length&&r.length===n.length))throw new Error("invalid arguments");var g=function(e){var r=[];return e.forEach(function(){r.push("?")}),r.join(",")};return l=r.join('","'),f=g(n),s="insert into "+e+' ( "'+l+'" ) values ( '+f+" )",u?o.transaction_executeSql(u,s,n,a,c):i.executeSql(s,n,t)},update:function(e,r,n,t,u,a){var c,s,l,f,g,d,m,v;if(!(e&&e.length&&angular.isObject(r)&&angular.isObject(n)))throw new Error("invalid arguments");s=[],f=[];for(m in r)if(r.hasOwnProperty(m)){if(void 0===r[m])throw new Error("column["+m+"] was empty");s.push('"'+m+'" = ?'),f.push(r[m])}if(0===s.length)throw new Error("columnsObj invalid arguments");return s=s.join(" , "),v=o.buildConditionSql(n),l=v.sql,g=v.values,c="update "+e+" set "+s+"  where "+l,d=f.concat(g),t?o.transaction_executeSql(t,c,d,u,a):i.executeSql(c,d)},"delete":function(e,r,n,t,u){var a,c,s,l;if(!e||!e.length||!angular.isObject(r))throw new Error("invalid arguments");return l=o.buildConditionSql(r),c=l.sql,s=l.values,a="delete from "+e+" where "+c,n?o.transaction_executeSql(n,a,s,t,u):i.executeSql(a,s)},getColumnsValues:function(e,r,n){var t=[];return n=n||[],r.forEach(function(r){if(o.checkObjPropHasValue(e,r))t.push(e[r]);else{if(-1===n.indexOf(r))throw new Error(r+"was empty");t.push("")}}),t},existsTable:function(e,r){return i.exists("sqlite_master",{type:"table",name:e},r)},existsColumn:function(e,r,n){return i.query("PRAGMA table_info('"+e+"')",[],n).then(function(e){return e?e.some(function(e){return e.name===r}):!1})},clearOpenedInstance:function(){a={}},deleteDB:function(n){var i;return e.when(t.ready()).then(function(){return n||o.getDefaultDBName()}).then(function(n){return i=e.defer(),n?(a[n]&&(a[n]=null,delete a[n]),o.getDBProvider().deleteDatabase(n,function(){i.resolve()},function(e){r.error("deleteDB:",e),i.reject(e&&e.message||e)})):(r.error("deleteDB：dbName is empty"),i.reject("db name is empty")),i.promise})}}}r.$inject=["$q","$log","device"];var n;angular.module("core").provider("localDB",e)}();