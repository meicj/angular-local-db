/*!
 * corgular-modules-core
 * https://github.com/meicj/corgular-modules-core
 * Version: 0.0.1 - 2016-03-05T09:52:36.868Z
 * License: MIT
 */
!function(){"use strict";angular.module("core",[])}(),function(){"use strict";function e(e){return{get:function(){var n=angular.element(e).injector();return n.get.apply(n.get,arguments)}}}function n(e,n){n._debugHelper=e}e.$inject=["$document"],n.$inject=["debugHelper","$window"],angular.module("core").factory("debugHelper",e).run(n)}(),function(){"use strict";function e(e,n,t,r){var i;return{ready:function(){var u=e.defer(),o=1e4;return i?u.resolve():(n.document.addEventListener("deviceready",function(){r.log("device is ready"),i=!0,u.resolve()},!1),t(function(){i||(r.error("ready: device was not ready after "+o/1e3+"s."),u.reject("device ready timeout"))},o)),u.promise}}}e.$inject=["$q","$window","$timeout","$log"],angular.module("core").factory("device",e)}(),function(){"use strict";function e(){var e,r=this;r.getDefaultDBName=function(){return"app"},r.getDBProvider=function(){return e||(e=window.sqlitePlugin)},r.$get=n,t=r}function n(e,n,r){var i,u,o,a={};return o=t,i={getDB:function(t){var i;return e.when(r.ready()).then(function(){return t||o.getDefaultDBName()}).then(function(t){return i=e.defer(),t?a[t]?i.resolve(a[t]):o.getDBProvider().openDatabase(t,function(e){a[t]=e,i.resolve(e)},function(e){n.error("_getDB:",e),i.reject(e)}):(n.error("_getDB：parameter of `dbName` was empty"),i.reject("db name is empty")),i.promise})},transaction_executeSql:function(e,t,r,u,o){e.executeSql(t,r,function(e,n){u&&u(n,i.buildTransaction(e))},function(e,r){return n.error("transaction_executeSql:",r,t),o&&o(r&&r.message,i.buildTransaction(e)),!0})},buildTransaction:function(e){var n={};return n.insert=function(n,t,r,i,o){u.insert(n,t,r,null,e,i,o)},n.update=function(n,t,r,i,o){u.update(n,t,r,e,i,o)},n["delete"]=function(n,t,r,i){u["delete"](n,t,e,r,i)},n.exists=function(n,t,r,i){u.exists(n,t,null,e,r,i)},n},buildConditionSql:function(e){var n,t;if(!angular.isObject(e))throw new Error("invalid argument");n=[],t=[];for(var r in e)if(e.hasOwnProperty(r)){if(!e[r]&&0!==e[r]&&""!==e[r])throw new Error("condition["+r+"] was empty");t.push(e[r]),n.push('"'+r+'" = ?')}if(0===n.length)throw new Error("invalid argument of `columnsObj`");return n=n.join(" and "),{sql:n,values:t}},checkObjPropHasValue:function(e,n){return e[n]||0===e[n]}},u={executeSql:function(t,r,u){var o,a=arguments;return e.when(i.getDB(u)).then(function(i){return o=e.defer(),i.executeSql(t,r,function(e){o.resolve(e)},function(e){n.error("executeSql:",e,JSON.stringify(a)),o.reject(e&&e.message)}),o.promise})},query:function(e,n,t){return u.executeSql(e,n,t).then(function(e){return u.getRowsToArray(e.rows)})},queryOne:function(e,n,t){return e+=" limit 1",u.executeSql(e,n,t).then(function(e){return e.rows&&e.rows.length?e.rows.item(0):void 0})},getRowsToArray:function(e){var n=[];e=e||[];for(var t=0,r=e.length;r>t;t++)n[t]=e.item(t);return n},transaction:function(t,r){var u=function(e){var n=i.buildTransaction(e);t(n)};return i.getDB(r).then(function(t){var r=e.defer();return t.transaction(u,function(e){n.error("transaction:",e),r.reject()},function(e){r.resolve(e)}),r.promise})},exists:function(e,n,t,r,o,a){var c,s,l,f,d=function(e){return e&&e.rows&&e.rows.length?!!e.rows.item(0).exists:!1};return c=i.buildConditionSql(n),s=c.sql,l=c.values,f='select 1 "exists" from '+e+" where "+s+" limit 1",r?i.transaction_executeSql(r,f,l,function(e,n){var t=d(e);o&&o(t,n)},a):u.executeSql(f,l,t).then(function(e){return d(e)})},insert:function(e,n,t,r,o,a,c){var s,l,f;if(!(e&&e.length&&angular.isArray(n)&&n.length&&angular.isArray(t)&&t.length&&n.length===t.length))throw new Error("invalid arguments");var d=function(e){var n=[];return e.forEach(function(){n.push("?")}),n.join(",")};return l=n.join('","'),f=d(t),s="insert into "+e+' ( "'+l+'" ) values ( '+f+" )",o?i.transaction_executeSql(o,s,t,a,c):u.executeSql(s,t,r)},update:function(e,n,t,r,o,a){var c,s,l,f,d,g,v,m;if(!(e&&e.length&&angular.isObject(n)&&angular.isObject(t)))throw new Error("invalid arguments");s=[],f=[];for(v in n)if(n.hasOwnProperty(v)){if(void 0===n[v])throw new Error("column["+v+"] was empty");s.push('"'+v+'" = ?'),f.push(n[v])}if(0===s.length)throw new Error("columnsObj invalid arguments");return s=s.join(" , "),m=i.buildConditionSql(t),l=m.sql,d=m.values,c="update "+e+" set "+s+"  where "+l,g=f.concat(d),r?i.transaction_executeSql(r,c,g,o,a):u.executeSql(c,g)},"delete":function(e,n,t,r,o){var a,c,s,l;if(!e||!e.length||!angular.isObject(n))throw new Error("invalid arguments");return l=i.buildConditionSql(n),c=l.sql,s=l.values,a="delete from "+e+" where "+c,t?i.transaction_executeSql(t,a,s,r,o):u.executeSql(a,s)},getColumnsValues:function(e,n,t){var r=[];return t=t||[],n.forEach(function(n){if(i.checkObjPropHasValue(e,n))r.push(e[n]);else{if(-1===t.indexOf(n))throw new Error(n+"was empty");r.push("")}}),r},existsTable:function(e,n){return u.exists("sqlite_master",{type:"table",name:e},n)},existsColumn:function(e,n,t){return u.query("PRAGMA table_info('"+e+"')",[],t).then(function(e){return e?e.some(function(e){return e.name===n}):!1})},clearOpenedInstance:function(){a={}},deleteDB:function(t){var u;return e.when(r.ready()).then(function(){return t||i.getDefaultDBName()}).then(function(t){return u=e.defer(),t?(a[t]&&(a[t]=null,delete a[t]),i.getDBProvider().deleteDatabase(t,function(){u.resolve()},function(e){n.error("deleteDB:",e),u.reject(e&&e.message||e)})):(n.error("deleteDB：dbName is empty"),u.reject("db name is empty")),u.promise})}}}n.$inject=["$q","$log","device"];var t;angular.module("core").provider("localDB",e)}();